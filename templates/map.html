<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ì œë¬¼í¬GO íŒ¨ìŠ¤ ì§€ë„ - ë‚´ íŒ¨ìŠ¤ ì¥ì†Œë“¤ v2.0</title>
    <!-- API Key Update: 2025-08-26 19:08 -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .map-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            margin-bottom: 20px;
        }

        #map {
            width: 100%;
            height: 600px;
        }

        .places-list {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .places-list h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .place-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #f8f9ff, #e6e9ff);
            border-radius: 10px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .place-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .place-marker {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 14px;
        }

        .place-info {
            flex: 1;
        }

        .place-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .place-desc {
            color: #666;
            font-size: 0.9em;
        }

        .back-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .buttons-container {
            text-align: center;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: white;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: linear-gradient(135deg, #fff5f5, #fed7d7);
            color: #c53030;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #fc8181;
            margin: 20px;
            text-align: center;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            #map {
                height: 400px;
            }
            
            .place-item {
                flex-direction: column;
                text-align: center;
            }
            
            .place-marker {
                margin-right: 0;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ—ºï¸ ì œë¬¼í¬GO íŒ¨ìŠ¤ ì§€ë„</h1>
        <p id="pass-title">ë‚´ íŒ¨ìŠ¤ì— í¬í•¨ëœ ì¥ì†Œë“¤ì„ í™•ì¸í•´ë³´ì„¸ìš”</p>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>íŒ¨ìŠ¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <div class="error" id="error" style="display: none;">
        íŒ¨ìŠ¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    </div>

    <div class="container" id="main-content" style="display: none;">
        <div class="map-container">
            <div id="map"></div>
        </div>

        <div class="places-list">
            <h3>ğŸ“ íŒ¨ìŠ¤ì— í¬í•¨ëœ ì¥ì†Œë“¤</h3>
            <div id="places-container">
                <!-- ì¥ì†Œ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <div class="buttons-container">
            <a href="/pass-generator" class="back-btn">â† íŒ¨ìŠ¤ ìƒì„±ê¸°ë¡œ</a>
            <a href="/main" class="back-btn">ğŸ  ë©”ì¸ìœ¼ë¡œ</a>
            <button onclick="testWithSampleData()" class="back-btn" style="background: linear-gradient(45deg, #f39c12, #e67e22);">ğŸ§ª ìƒ˜í”Œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸</button>
            <button onclick="showApiKeyHelp()" class="back-btn" style="background: linear-gradient(45deg, #9b59b6, #8e44ad);">ğŸ”§ API í‚¤ ì„¤ì • ë„ì›€ë§</button>
        </div>
    </div>

    <script>
        // ì¹´ì¹´ì˜¤ë§µ API í‚¤ - í™˜ê²½ ë³€ìˆ˜ì—ì„œ ë¡œë“œ
        const apiKey = "{{ kakao_api_key }}";
        console.log('ğŸ”‘ [2025-08-26 19:08] ì‚¬ìš© ì¤‘ì¸ ì¹´ì¹´ì˜¤ë§µ API í‚¤:', apiKey);
        console.log('ğŸ”‘ API í‚¤ ì—…ë°ì´íŠ¸ í™•ì¸: ENV VARIABLE LOADED');
        
        // ë§¤ì¥ ìœ„ì¹˜ ë§ˆì»¤ ìƒì„± í•¨ìˆ˜
        function generateLocationMarkers(stores) {
            if (!stores || stores.length === 0) return '';
            
            const areaColors = {
                'ì°¨ì´ë‚˜íƒ€ìš´': '#ff9800',
                'ì›”ë¯¸ë„': '#4caf50', 
                'ê°œí•­ë¡œ': '#9c27b0',
                'ê³¨ëª©ìƒê¶Œ': '#03a9f4',
                'ì¸ì²œì—­': '#f44336',
                'ì œë¬¼í¬ì‹œì¥': '#795548'
            };
            
            let markersHtml = '';
            stores.forEach((store, index) => {
                const location = storeLocations[store.name];
                if (location) {
                    const color = areaColors[location.area] || '#666';
                    // ìƒëŒ€ì  ìœ„ì¹˜ ê³„ì‚° (ì„ì‹œ)
                    const left = 20 + (index % 4) * 20;
                    const top = 20 + Math.floor(index / 4) * 15;
                    
                    markersHtml += `
                        <div style="
                            position: absolute; 
                            left: ${left}%; 
                            top: ${top}%; 
                            width: 30px; 
                            height: 30px; 
                            background: ${color}; 
                            border-radius: 50%; 
                            display: flex; 
                            align-items: center; 
                            justify-content: center; 
                            color: white; 
                            font-weight: bold; 
                            font-size: 12px;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                            cursor: pointer;
                            pointer-events: all;
                            transition: transform 0.2s ease;
                        " 
                        onmouseover="this.style.transform='scale(1.2)'" 
                        onmouseout="this.style.transform='scale(1)'"
                        onclick="highlightMapArea('${store.name}')"
                        title="${store.name} - ${location.area}">
                            ${index + 1}
                        </div>
                    `;
                }
            });
            
            return markersHtml;
        }

        // ì§€ë„ì™€ ë§ˆì»¤ ê´€ë¦¬ ë³€ìˆ˜
        let map;
        let markers = [];
        
        // íŒ¨ìŠ¤ ë°ì´í„°ì™€ ì¥ì†Œ ì¢Œí‘œ ë§¤í•‘ (í•˜ë“œì½”ë”©ëœ ë°ì´í„° ì‚¬ìš©)
        let storeLocations = {
            "ì›”ë¯¸ë„ íšŸì§‘": { lat: 37.4759, lng: 126.5954, area: "ì›”ë¯¸ë„", desc: "ì‹ ì„ í•œ í•´ì‚°ë¬¼ì„ ì¦ê¸¸ ìˆ˜ ìˆëŠ” ê³³" },
            "ê°œí•­ë¡œ ì±…ë°©": { lat: 37.4763, lng: 126.6163, area: "ê°œí•­ë¡œ", desc: "ì˜¤ë˜ëœ ì±…ê³¼ ì´ì•¼ê¸°ê°€ ìˆëŠ” ê³³" },
            "ì°¨ì´ë‚˜íƒ€ìš´ ë§Œë‘ì§‘": { lat: 37.4756, lng: 126.6173, area: "ì°¨ì´ë‚˜íƒ€ìš´", desc: "ì „í†µ ë°©ì‹ìœ¼ë¡œ ë§Œë“  ìˆ˜ì œ ë§Œë‘" },
            "ê³¨ëª©ì¹´í˜ íë§": { lat: 37.4765, lng: 126.6158, area: "ê³¨ëª©ìƒê¶Œ", desc: "ì¡°ìš©í•œ ê³¨ëª© ì† ìˆ¨ì€ ì¹´í˜" },
            "ìŠ¤íƒ€ë²…ìŠ¤ ì¸ì²œì—­ì ": { lat: 37.4755, lng: 126.6169, area: "ì¸ì²œì—­", desc: "í¸ë¦¬í•œ ìœ„ì¹˜ì˜ í”„ëœì°¨ì´ì¦ˆ ì¹´í˜" },
            "ì œë¬¼í¬ ì „í†µì‹œì¥ ë–¡ì§‘": { lat: 37.4761, lng: 126.6167, area: "ì œë¬¼í¬ì‹œì¥", desc: "3ëŒ€ì§¸ ì´ì–´ì˜¨ ì „í†µ ë–¡ì§‘" },
            "ë°”ë‹¤í’ê²½ íœì…˜ì¹´í˜": { lat: 37.4758, lng: 126.5951, area: "ì›”ë¯¸ë„", desc: "ë°”ë‹¤ë¥¼ ë³´ë©° ì»¤í”¼ë¥¼ ë§ˆì‹¤ ìˆ˜ ìˆëŠ” ê³³" },
            "ê³¨ëª© ìˆ˜ì œë²„ê±°": { lat: 37.4767, lng: 126.6155, area: "ê³¨ëª©ìƒê¶Œ", desc: "ì‘ì€ ê³¨ëª©ì˜ ìˆ˜ì œ í–„ë²„ê±° ì „ë¬¸ì " },
            "ì „í†µ í•œì˜¥ì¹´í˜": { lat: 37.4764, lng: 126.6161, area: "ê°œí•­ë¡œ", desc: "í•œì˜¥ì„ ê°œì¡°í•œ ì „í†µì°¨ ì „ë¬¸ì " },
            "ë§¥ë„ë‚ ë“œ ì¸ì²œì ": { lat: 37.4754, lng: 126.6171, area: "ì¸ì²œì—­", desc: "ê¸€ë¡œë²Œ íŒ¨ìŠ¤íŠ¸í‘¸ë“œ ì²´ì¸ì " },
            "ê³¨ëª© ë–¡ë³¶ì´": { lat: 37.4766, lng: 126.6156, area: "ê³¨ëª©ìƒê¶Œ", desc: "30ë…„ ì „í†µì˜ ê³¨ëª© ë–¡ë³¶ì´ì§‘" },
            "ì œë¬¼í¬ ê°¤ëŸ¬ë¦¬ì¹´í˜": { lat: 37.4762, lng: 126.6165, area: "ê°œí•­ë¡œ", desc: "ì§€ì—­ ì‘ê°€ë“¤ì˜ ì‘í’ˆì„ ì „ì‹œí•˜ëŠ” ê°¤ëŸ¬ë¦¬ ì¹´í˜" },
            "ë°”ë‹¤ì†Œë¦¬ íœì…˜": { lat: 37.4757, lng: 126.5952, area: "ì›”ë¯¸ë„", desc: "íŒŒë„ì†Œë¦¬ë¥¼ ë“¤ìœ¼ë©° íœ´ì‹í•  ìˆ˜ ìˆëŠ” íœì…˜" },
            "ì°¨ì´ë‚˜íƒ€ìš´ ì•½ì¬ìƒ": { lat: 37.4757, lng: 126.6175, area: "ì°¨ì´ë‚˜íƒ€ìš´", desc: "100ë…„ ì „í†µì˜ í•œì•½ì¬ ì „ë¬¸ì " },
            "ì›”ë¯¸ê³µì› ì‚¬ì§„ê´€": { lat: 37.4760, lng: 126.5955, area: "ì›”ë¯¸ë„", desc: "ì—¬í–‰ ê¸°ë…ì‚¬ì§„ ì „ë¬¸ ìŠ¤íŠœë””ì˜¤" },
            "ì¸ì²œ ììœ ê³µì› ë§¤ì ": { lat: 37.4749, lng: 126.6157, area: "ììœ ê³µì›", desc: "ê³µì› ë‚´ ìœ ì¼í•œ ë§¤ì " },
            "ì œë¬¼í¬ ìˆ˜ì œ ë§¥ì£¼ì§‘": { lat: 37.4762, lng: 126.6168, area: "ì œë¬¼í¬ì‹œì¥", desc: "ì§€ì—­ ì–‘ì¡°ì¥ì—ì„œ ë§Œë“  ìˆ˜ì œ ë§¥ì£¼ ì „ë¬¸ì " },
            "ê°œí•­ë¡œ ë¹ˆí‹°ì§€ìƒµ": { lat: 37.4763, lng: 126.6162, area: "ê°œí•­ë¡œ", desc: "1960-80ë…„ëŒ€ ë¹ˆí‹°ì§€ ì˜ë¥˜ ì „ë¬¸ì " },
            "ê³¨ëª© ì¹˜í‚¨ì§‘": { lat: 37.4768, lng: 126.6154, area: "ê³¨ëª©ìƒê¶Œ", desc: "ë°”ì‚­í•œ ì¹˜í‚¨ìœ¼ë¡œ ìœ ëª…í•œ ë™ë„¤ ì¹˜í‚¨ì§‘" },
            "ì°¨ì´ë‚˜íƒ€ìš´ ì§œì¥ë©´ì§‘": { lat: 37.4755, lng: 126.6174, area: "ì°¨ì´ë‚˜íƒ€ìš´", desc: "ì§„ì§œ ì°¨ì´ë‚˜íƒ€ìš´ ë§›ì„ ìë‘í•˜ëŠ” ì§œì¥ë©´ì§‘" },
            "ì›”ë¯¸ë„ ë°”ë‹¤ì¹´í˜": { lat: 37.4759, lng: 126.5953, area: "ì›”ë¯¸ë„", desc: "ì›”ë¯¸ë„ ìµœê³ ì˜ ì¼ëª° ë·°ë¥¼ ìë‘í•˜ëŠ” ì¹´í˜" },
            "ì œë¬¼í¬ ê³µë°©": { lat: 37.4760, lng: 126.6166, area: "ì œë¬¼í¬ì‹œì¥", desc: "ë„ìê¸°, ê°€ì£½ê³µì˜ˆ ë“±ì„ ì²´í—˜í•  ìˆ˜ ìˆëŠ” ê³µë°©" },
            "ê°œí•­ë¡œ ê³ ì„œì ": { lat: 37.4764, lng: 126.6160, area: "ê°œí•­ë¡œ", desc: "í¬ê·€í•œ ê³ ì„œì™€ ì ˆíŒ ë„ì„œë¥¼ íŒë§¤í•˜ëŠ” ì„œì " },
            "ê³¨ëª© ìˆœëŒ€êµ­ì§‘": { lat: 37.4765, lng: 126.6157, area: "ê³¨ëª©ìƒê¶Œ", desc: "í• ë¨¸ë‹ˆ ì†ë§›ì„ ìë‘í•˜ëŠ” ìˆœëŒ€êµ­ ì „ë¬¸ì " },
            "ì¸ì²œì—­ í¸ì˜ì ": { lat: 37.4753, lng: 126.6170, area: "ì¸ì²œì—­", desc: "ì¸ì²œì—­ ë‚´ 24ì‹œê°„ í¸ì˜ì " },
            "ì›”ë¯¸ë„ í•´ë¬¼ì°œ": { lat: 37.4758, lng: 126.5956, area: "ì›”ë¯¸ë„", desc: "ì‹ ì„ í•œ í•´ë¬¼ë¡œ ë§Œë“  ë§¤ì½¤í•œ í•´ë¬¼ì°œ ì „ë¬¸ì " },
            "ì°¨ì´ë‚˜íƒ€ìš´ ì›”ë³‘ì§‘": { lat: 37.4756, lng: 126.6172, area: "ì°¨ì´ë‚˜íƒ€ìš´", desc: "ì „í†µ ë°©ì‹ìœ¼ë¡œ ë§Œë“  ì›”ë³‘ê³¼ ì¤‘êµ­ ê³¼ì ì „ë¬¸ì " },
            "ì œë¬¼í¬ ê½ƒì§‘": { lat: 37.4761, lng: 126.6164, area: "ì œë¬¼í¬ì‹œì¥", desc: "ì‹ ì„ í•œ ê½ƒê³¼ í™”ë¶„ì„ íŒë§¤í•˜ëŠ” ë™ë„¤ ê½ƒì§‘" },
            "ê°œí•­ë¡œ íƒ€ë¡œì¹´í˜": { lat: 37.4765, lng: 126.6159, area: "ê°œí•­ë¡œ", desc: "íƒ€ë¡œ ìƒë‹´ì„ ë°›ì„ ìˆ˜ ìˆëŠ” íŠ¹ë³„í•œ ì¹´í˜" },
            "ê³¨ëª© ê¹€ë°¥ì²œêµ­": { lat: 37.4769, lng: 126.6153, area: "ê³¨ëª©ìƒê¶Œ", desc: "24ì‹œê°„ ìš´ì˜í•˜ëŠ” ê¹€ë°¥ ì „ë¬¸ì " },
            "ì›”ë¯¸ë„ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤": { lat: 37.4761, lng: 126.5957, area: "ì›”ë¯¸ë„", desc: "ë°°ë‚­ì—¬í–‰ê°ì„ ìœ„í•œ ê²½ì œì ì¸ ìˆ™ì†Œ" },
            "ì°¨ì´ë‚˜íƒ€ìš´ ì„ ë¬¼ê°€ê²Œ": { lat: 37.4758, lng: 126.6176, area: "ì°¨ì´ë‚˜íƒ€ìš´", desc: "ì°¨ì´ë‚˜íƒ€ìš´ íŠ¹ìƒ‰ ê¸°ë…í’ˆ ì „ë¬¸ì " },
            "ì œë¬¼í¬ ë…¸ë˜ë°©": { lat: 37.4763, lng: 126.6169, area: "ì œë¬¼í¬ì‹œì¥", desc: "ìµœì‹  ìŒí–¥ì‹œì„¤ì„ ê°–ì¶˜ ë…¸ë˜ë°©" },
            "ê°œí•­ë¡œ ë¬¸ë°©êµ¬": { lat: 37.4766, lng: 126.6158, area: "ê°œí•­ë¡œ", desc: "ì˜›ë‚  ì¶”ì–µì´ ë‹´ê¸´ ë ˆíŠ¸ë¡œ ë¬¸ë°©êµ¬" },
            "ê³¨ëª© ì¡±ë°œì§‘": { lat: 37.4770, lng: 126.6152, area: "ê³¨ëª©ìƒê¶Œ", desc: "ì«„ê¹ƒí•œ ì¡±ë°œë¡œ ìœ ëª…í•œ ê³¨ëª© ë§›ì§‘" }
        };

        // stores.jsonì—ì„œ ì¢Œí‘œ ë°ì´í„° ë¡œë“œ
        async function loadStoreLocations() {
            console.log('APIì—ì„œ ë§¤ì¥ ë°ì´í„° ë¡œë“œ ì‹œë„...');
            try {
                console.log('í˜„ì¬ URL:', window.location.href);
                console.log('API URL:', '/api/stores');
                
                const response = await fetch('/api/stores');
                console.log('API ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API ì‘ë‹µ ì˜¤ë¥˜:', response.status, errorText);
                    throw new Error(`HTTP error! status: ${response.status}, response: ${errorText}`);
                }
                
                const data = await response.json();
                console.log('API ì‘ë‹µ ë°ì´í„°:', data);
                
                // ë§¤ì¥ ì´ë¦„ì„ í‚¤ë¡œ í•˜ëŠ” ì¢Œí‘œ ê°ì²´ ìƒì„±
                if (data.stores && Array.isArray(data.stores)) {
                    const apiStoreLocations = {};
                    data.stores.forEach(store => {
                        if (store.latitude && store.longitude) {
                            apiStoreLocations[store.name] = {
                                lat: store.latitude,
                                lng: store.longitude,
                                area: store.location || store.area,
                                desc: store.description || store.desc || 'íŠ¹ë³„í•œ í˜œíƒì„ ì œê³µí•˜ëŠ” ë§¤ì¥ì…ë‹ˆë‹¤.'
                            };
                        }
                    });
                    
                    // ê¸°ì¡´ í•˜ë“œì½”ë”© ë°ì´í„°ì™€ ë³‘í•©
                    storeLocations = {...storeLocations, ...apiStoreLocations};
                    console.log('APIì—ì„œ ë¡œë“œëœ ë§¤ì¥ ì¢Œí‘œ:', Object.keys(apiStoreLocations).length, 'ê°œ');
                    console.log('ì´ ë§¤ì¥ ì¢Œí‘œ:', Object.keys(storeLocations).length, 'ê°œ');
                } else {
                    console.log('API ì‘ë‹µì— stores ë°°ì—´ì´ ì—†ìŒ, í•˜ë“œì½”ë”© ë°ì´í„° ì‚¬ìš©');
                }
                
            } catch (error) {
                console.error('ë§¤ì¥ ì¢Œí‘œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                console.log('ì˜¤ë¥˜ ìƒì„¸:', error.message);
                console.log('ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤:', error.stack);
                console.log('í•˜ë“œì½”ë”©ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.');
            }
        }

        // URLì—ì„œ íŒ¨ìŠ¤ ID ì¶”ì¶œ
        function getPassIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('passId');
        }

        // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ íŒ¨ìŠ¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getPassDataFromSession() {
            console.log('ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ í™•ì¸ ì¤‘...');
            const passData = sessionStorage.getItem('currentPassData');
            console.log('ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì›ë³¸ ë°ì´í„°:', passData);
            
            if (passData) {
                try {
                    const parsed = JSON.parse(passData);
                    console.log('íŒŒì‹±ëœ íŒ¨ìŠ¤ ë°ì´í„°:', parsed);
                    return parsed;
                } catch (error) {
                    console.error('íŒ¨ìŠ¤ ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', error);
                    return null;
                }
            }
            
            console.log('ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— íŒ¨ìŠ¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
            return null;
        }

        // íŒ¨ìŠ¤ ë°ì´í„° ë¡œë“œ
        async function loadPassData() {
            console.log('íŒ¨ìŠ¤ ë°ì´í„° ë¡œë“œ ì‹œì‘');
            
            const passId = getPassIdFromUrl();
            console.log('URL íŒ¨ìŠ¤ ID:', passId);
            
            // ë¨¼ì € ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° í™•ì¸
            let passData = getPassDataFromSession();
            
            if (passData) {
                console.log('ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ì°¾ìŒ:', passData);
                return passData;
            }
            
            // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìƒ˜í”Œ ë°ì´í„° ìƒì„±
            console.log('ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì—†ìŒ, ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©');
            const sampleData = {
                pass_id: 'sample_pass',
                pass_type: 'ìŠ¤íƒ ë‹¤ë“œ íŒ¨ìŠ¤',
                theme: 'ë§›ì§‘ íƒë°©',
                stores: [
                    { name: 'ì›”ë¯¸ë„ íšŸì§‘', desc: 'ì‹ ì„ í•œ í•´ì‚°ë¬¼ ìš”ë¦¬ 20% í• ì¸' },
                    { name: 'ì°¨ì´ë‚˜íƒ€ìš´ ë§Œë‘ì§‘', desc: 'ì „í†µ ìˆ˜ì œ ë§Œë‘ íŠ¹ë³„ í˜œíƒ' },
                    { name: 'ê³¨ëª©ì¹´í˜ íë§', desc: 'ì»¤í”¼ 1+1 ì´ë²¤íŠ¸' },
                    { name: 'ì œë¬¼í¬ ì „í†µì‹œì¥ ë–¡ì§‘', desc: 'ì „í†µ ê°„ì‹ ì²´í—˜ ì¿ í°' }
                ]
            };
            
            console.log('ìƒ˜í”Œ ë°ì´í„° ìƒì„±:', sampleData);
            return sampleData;
        }

        // ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™”
        function initializeMap() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•œ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
                const timestamp = new Date().getTime();
                script.src = `//dapi.kakao.com/v2/maps/sdk.js?appkey=${apiKey}&autoload=false&_t=${timestamp}`;
                
                document.head.appendChild(script);

                script.onload = () => {
                    try {
                        kakao.maps.load(() => {
                            const mapContainer = document.getElementById('map');
                            const mapOption = {
                                center: new kakao.maps.LatLng(37.4760, 126.6163), // ì¸ì²œ ì°¨ì´ë‚˜íƒ€ìš´ ì¤‘ì‹¬
                                level: 5
                            };
                            map = new kakao.maps.Map(mapContainer, mapOption);
                            console.log('ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™” ì„±ê³µ');
                            resolve();
                        });
                    } catch (error) {
                        console.error('ì¹´ì¹´ì˜¤ë§µ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                        reject(error);
                    }
                };

                script.onerror = (error) => {
                    console.error('ì¹´ì¹´ì˜¤ë§µ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                    console.error('API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë„ë©”ì¸ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    reject(new Error('ì¹´ì¹´ì˜¤ë§µ API í‚¤ ì˜¤ë¥˜ - ìƒˆë¡œìš´ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤'));
                };
            });
        }

        // ì§€ë„ì— ë§ˆì»¤ ì¶”ê°€
        function addMarkersToMap(stores) {
            // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
            markers.forEach(marker => marker.setMap(null));
            markers = [];
            
            const bounds = new kakao.maps.LatLngBounds();
            
            stores.forEach((store, index) => {
                const location = storeLocations[store.name];
                
                if (location) {
                    const position = new kakao.maps.LatLng(location.lat, location.lng);
                    
                    // ì»¤ìŠ¤í…€ ë§ˆì»¤ ìƒì„±
                    const marker = new kakao.maps.Marker({
                        position: position,
                        map: map
                    });
                    
                    // ì¸í¬ìœˆë„ìš° ìƒì„±
                    const infowindow = new kakao.maps.InfoWindow({
                        content: `
                            <div style="padding:10px; min-width:200px;">
                                <strong style="color:#667eea;">${store.name}</strong><br>
                                <small style="color:#666;">${location.area}</small><br>
                                <span style="color:#333; font-size:0.9em;">${store.desc || 'ë§›ìˆëŠ” ìŒì‹ê³¼ íŠ¹ë³„í•œ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.'}</span>
                            </div>
                        `
                    });
                    
                    // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸
                    kakao.maps.event.addListener(marker, 'click', function() {
                        infowindow.open(map, marker);
                    });
                    
                    markers.push(marker);
                    bounds.extend(position);
                } else {
                    console.warn('ì¥ì†Œ ì¢Œí‘œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', store.name);
                }
            });
            
            // ëª¨ë“  ë§ˆì»¤ê°€ ë³´ì´ë„ë¡ ì§€ë„ ë²”ìœ„ ì¡°ì •
            if (stores.length > 0) {
                map.setBounds(bounds);
            }
        }

        // ì¥ì†Œ ëª©ë¡ ë Œë”ë§
        function renderPlacesList(stores) {
            const container = document.getElementById('places-container');
            container.innerHTML = '';
            
            stores.forEach((store, index) => {
                const location = storeLocations[store.name];
                const placeElement = document.createElement('div');
                placeElement.className = 'place-item';
                placeElement.innerHTML = `
                    <div class="place-marker">${index + 1}</div>
                    <div class="place-info">
                        <div class="place-name">${store.name}</div>
                        <div class="place-desc">${location ? location.area : 'ìœ„ì¹˜ ì •ë³´ ì—†ìŒ'} | ${store.desc || 'ë§›ìˆëŠ” ìŒì‹ê³¼ íŠ¹ë³„í•œ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.'}</div>
                    </div>
                `;
                
                // í´ë¦­ ì‹œ í•´ë‹¹ ë§ˆì»¤ë¡œ ì´ë™
                placeElement.addEventListener('click', () => {
                    if (location) {
                        // ì¹´ì¹´ì˜¤ë§µì´ ìˆì„ ë•Œì™€ ì—†ì„ ë•Œ êµ¬ë¶„
                        if (typeof highlightMapArea === 'function') {
                            highlightMapArea(store.name);
                        } else if (markers[index]) {
                            const position = new kakao.maps.LatLng(location.lat, location.lng);
                            map.setCenter(position);
                            map.setLevel(3);
                            
                            // í•´ë‹¹ ë§ˆì»¤ì˜ ì¸í¬ìœˆë„ìš° ì—´ê¸°
                            kakao.maps.event.trigger(markers[index], 'click');
                        }
                    }
                });
                
                container.appendChild(placeElement);
            });
        }

        // í˜ì´ì§€ ì´ˆê¸°í™”
        async function initializePage() {
            console.log('í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘');
            document.getElementById('loading').style.display = 'block';
            
            try {
                // ë§¤ì¥ ì¢Œí‘œ ë°ì´í„° ë¡œë“œ
                console.log('ë§¤ì¥ ì¢Œí‘œ ë¡œë“œ ì¤‘...');
                await loadStoreLocations();
                
                // íŒ¨ìŠ¤ ë°ì´í„° ë¡œë“œ
                console.log('íŒ¨ìŠ¤ ë°ì´í„° ë¡œë“œ ì¤‘...');
                const passData = await loadPassData();
                
                if (!passData) {
                    throw new Error('íŒ¨ìŠ¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                console.log('ë¡œë“œëœ íŒ¨ìŠ¤ ë°ì´í„°:', passData);
                
                // íŒ¨ìŠ¤ ì •ë³´ ì—…ë°ì´íŠ¸
                if (passData.pass_type && passData.theme) {
                    document.getElementById('pass-title').textContent = 
                        `${passData.pass_type} - ${passData.theme} í…Œë§ˆ íŒ¨ìŠ¤ì˜ ì¥ì†Œë“¤`;
                }
                
                // ë§¤ì¥ ëª©ë¡ ë¨¼ì € ë Œë”ë§ (ì§€ë„ ì—†ì´ë„ í‘œì‹œ)
                if (passData.stores && passData.stores.length > 0) {
                    renderPlacesList(passData.stores);
                    console.log('ë§¤ì¥ ëª©ë¡ ë Œë”ë§ ì™„ë£Œ');
                }
                
                // ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™” ì‹œë„
                try {
                    console.log('ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™” ì¤‘...');
                    await initializeMap();
                    console.log('ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™” ì™„ë£Œ');
                    
                    // ì§€ë„ ì´ˆê¸°í™” ì„±ê³µ ì‹œ ë§ˆì»¤ ì¶”ê°€
                    if (passData.stores && passData.stores.length > 0) {
                        addMarkersToMap(passData.stores);
                        console.log('ì§€ë„ ë§ˆì»¤ ì¶”ê°€ ì™„ë£Œ');
                    }
                } catch (mapError) {
                    console.error('ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™” ì‹¤íŒ¨:', mapError);
                    
                    // ì§€ë„ ì»¨í…Œì´ë„ˆì— OpenStreetMap ëŒ€ì²´ ì§€ë„ í‘œì‹œ
                    const mapContainer = document.getElementById('map');
                    mapContainer.innerHTML = `
                        <div style="position: relative; width: 100%; height: 100%; background: #f0f8ff;">
                            <!-- ì§€ë„ ì˜ì—­ -->
                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                <div style="background: rgba(255,255,255,0.9); padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; max-width: 500px;">
                                    <div style="font-size: 4em; margin-bottom: 20px;">ğŸ—ºï¸</div>
                                    <div style="font-size: 1.5em; font-weight: bold; margin-bottom: 15px; color: #1976d2;">ì¸ì²œ ë™ì¸ì²œ ê´€ê´‘ì§€ë„</div>
                                    <div style="font-size: 1em; color: #666; margin-bottom: 20px;">
                                        ì¹´ì¹´ì˜¤ë§µ API ì—°ê²° ë¬¸ì œë¡œ ì¸í•´<br>
                                        ì„ì‹œ ì§€ë„ë¥¼ í‘œì‹œí•˜ê³  ìˆìŠµë‹ˆë‹¤
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                                        <div style="background: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #ff9800;">
                                            <strong style="color: #e65100;">ì°¨ì´ë‚˜íƒ€ìš´</strong><br>
                                            <small style="color: #666;">ì „í†µ ì¤‘ì‹ë‹¹ê³¼ ë¬¸í™” ì²´í—˜</small>
                                        </div>
                                        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 4px solid #4caf50;">
                                            <strong style="color: #2e7d32;">ì›”ë¯¸ë„</strong><br>
                                            <small style="color: #666;">ë°”ë‹¤ ì „ë§ê³¼ í•´ì‚°ë¬¼ ìš”ë¦¬</small>
                                        </div>
                                        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #9c27b0;">
                                            <strong style="color: #7b1fa2;">ê°œí•­ë¡œ</strong><br>
                                            <small style="color: #666;">ì—­ì‚¬ì  ê±´ë¬¼ê³¼ ì¹´í˜</small>
                                        </div>
                                        <div style="background: #e1f5fe; padding: 15px; border-radius: 8px; border-left: 4px solid #03a9f4;">
                                            <strong style="color: #0277bd;">ê³¨ëª©ìƒê¶Œ</strong><br>
                                            <small style="color: #666;">ìˆ¨ì€ ë§›ì§‘ê³¼ ì „í†µ ì‹œì¥</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ë§¤ì¥ ìœ„ì¹˜ í‘œì‹œ -->
                            <div id="location-markers" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
                                ${generateLocationMarkers(passData.stores)}
                            </div>
                        </div>
                    `;
                    
                    // ë§¤ì¥ ëª©ë¡ì—ì„œ í´ë¦­í–ˆì„ ë•Œ í•´ë‹¹ ì˜ì—­ ê°•ì¡°
                    window.highlightMapArea = (storeName) => {
                        const location = storeLocations[storeName];
                        if (location) {
                            console.log(`${storeName} ìœ„ì¹˜: ${location.area} ì˜ì—­`);
                            // ê°„ë‹¨í•œ ì•Œë¦¼ìœ¼ë¡œ ìœ„ì¹˜ ì •ë³´ í‘œì‹œ
                            alert(`ğŸ“ ${storeName}\\nìœ„ì¹˜: ${location.area}\\n${location.desc || ''}`);
                        }
                    };
                }
                
                // ë¡œë”© ìˆ¨ê¸°ê³  ë©”ì¸ ì»¨í…ì¸  í‘œì‹œ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                console.log('í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
                
            } catch (error) {
                console.error('í˜ì´ì§€ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = error.message || 'íŒ¨ìŠ¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            }
        }

        // API í‚¤ ì„¤ì • ë„ì›€ë§ í‘œì‹œ
        function showApiKeyHelp() {
            alert(`ğŸ”§ ì¹´ì¹´ì˜¤ë§µ API í‚¤ ì„¤ì • ë°©ë²•

1. ì¹´ì¹´ì˜¤ ê°œë°œì ì½˜ì†” ì ‘ì†:
   https://developers.kakao.com/console/app

2. ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± ë˜ëŠ” ì„ íƒ

3. í”Œë«í¼ ì„¤ì • â†’ Web í”Œë«í¼ ì¶”ê°€

4. ì‚¬ì´íŠ¸ ë„ë©”ì¸ ë“±ë¡:
   - http://127.0.0.1:8080
   - http://localhost:8080
   - ê¸°íƒ€ ì‚¬ìš©í•  ë„ë©”ì¸

5. JavaScript í‚¤ë¥¼ ë³µì‚¬í•˜ì—¬ ì½”ë“œì— ì ìš©

í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í‚¤: ${apiKey}
í˜„ì¬ ìƒíƒœ: API í‚¤ ê¶Œí•œ ì˜¤ë¥˜ (403)`);
        }

        // í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ë°ì´í„° í•¨ìˆ˜
        function testWithSampleData() {
            console.log('ìƒ˜í”Œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            
            const sampleData = {
                pass_id: 'test_pass_123',
                pass_type: 'ìŠ¤íƒ ë‹¤ë“œ íŒ¨ìŠ¤',
                theme: 'ë§›ì§‘ íƒë°©',
                stores: [
                    { name: 'ì›”ë¯¸ë„ íšŸì§‘', desc: 'ì‹ ì„ í•œ í•´ì‚°ë¬¼ ìš”ë¦¬ 20% í• ì¸' },
                    { name: 'ì°¨ì´ë‚˜íƒ€ìš´ ë§Œë‘ì§‘', desc: 'ì „í†µ ìˆ˜ì œ ë§Œë‘ íŠ¹ë³„ í˜œíƒ' },
                    { name: 'ê³¨ëª©ì¹´í˜ íë§', desc: 'ì»¤í”¼ 1+1 ì´ë²¤íŠ¸' },
                    { name: 'ì œë¬¼í¬ ì „í†µì‹œì¥ ë–¡ì§‘', desc: 'ì „í†µ ê°„ì‹ ì²´í—˜ ì¿ í°' },
                    { name: 'ë°”ë‹¤í’ê²½ íœì…˜ì¹´í˜', desc: 'ë°”ë‹¤ ë·° ì¹´í˜ ë””ì €íŠ¸ í• ì¸' }
                ]
            };
            
            // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            sessionStorage.setItem('currentPassData', JSON.stringify(sampleData));
            console.log('ìƒ˜í”Œ ë°ì´í„° ì €ì¥ ì™„ë£Œ');
            
            // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
            location.reload();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>